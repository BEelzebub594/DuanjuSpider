# DuanjuSpider 短剧搜索插件

## 插件介绍

DuanjuSpider是一个微信机器人插件，用于在群聊中搜索短剧资源。通过简单的命令，可以快速查找各类短剧并获取网盘链接，为群友提供便捷的资源获取方式。

作者: BEelzebub  
版本: 1.2.0

## 功能特点

- 支持多个搜索源，自动选择可用站点
- 自动解析短链获取最新可用站点
- 支持断线重连和站点自动切换
- 支持群聊白名单，只在指定群聊中生效
- 完全异步实现，不阻塞主线程
- 支持网盘链接提取
- 丰富的日志记录
- 二步操作逻辑，避免一次性输出大量链接
- 搜索结果缓存，提高响应速度
- 支持加剧功能，可以提交未收录的剧名

## 安装方法

1. 确保已安装所需的依赖：
```bash
pip install requests beautifulsoup4 aiohttp loguru tomli
```

2. 将`DuanjuSpider`文件夹复制到机器人的插件目录中

3. 重启机器人或加载插件

## 配置说明

插件配置文件为`config.toml`，主要配置项如下：

```toml
[DuanjuSpider]
enable = true                               # 是否启用插件

# 短剧搜索命令
command = "短剧"                            # 触发插件的命令前缀

# 加剧命令
add_drama_command = "加剧"                  # 提交未收录剧名的命令前缀

# 群聊白名单，只在这些群聊中生效
whitelist_groups = ["38791621365@chatroom", "34587307323@chatroom"]

# 每次搜索显示的最大结果数
max_results = 10                            # 每次显示的最大搜索结果数量

# 搜索基础URL列表，用于查询短剧资源
# 程序会依次尝试列表中的URL，直到找到可用的站点
base_urls = [
    "https://a80.35240.com/search.php",
    "https://b.21410.com/search.php"
]

# 短链接列表，用于解析获取最新的可用站点
# 程序会自动解析这些短链，并将解析结果添加到base_urls中
short_urls = [
    "A80.CC",
    "A20.CC",
    "E50.CC",
    "47C.CC"
]
```

程序会使用`search_urls.json`文件来存储已解析的URL和运行时更新的URL列表。该文件会在首次运行时根据config.toml中的配置自动创建，格式如下：

```json
{
    "base_urls": [
        "https://a80.35240.com/search.php",
        "https://b.21410.com/search.php"
    ],
    "short_urls": [
        "A80.CC",
        "A20.CC",
        "E50.CC",
        "47C.CC"
    ]
}
```

您可以根据需要修改这些配置文件。如果希望立即添加新的搜索站点，可以直接在`config.toml`中的`base_urls`添加；如果想添加新的短链来源，可以在`short_urls`中添加。

## 使用方法

在已配置的群聊中，使用以下命令格式：

### 1. 搜索剧名

```
短剧 [剧名]
```

例如：
```
短剧 纵横商海
```

机器人会返回搜索结果列表，每个结果前会显示编号。

### 2. 获取详细信息

```
短剧# [编号]
```

例如：
```
短剧# 1
```

机器人会返回该编号对应的详细信息，包含剧名和网盘链接。

### 3. 提交未收录的剧名

如果搜索不到想要的短剧，可以使用加剧命令提交：

```
加剧 [剧名]
```

例如：
```
加剧 狼人爹地找上门
```

机器人会将该剧名提交到短剧网站，通常在1天后可以搜索到相关资源。

## 工作原理

1. 插件启动时会解析配置的短链接，获取最新的搜索站点URL
2. 接收到符合命令格式的消息后，会依次尝试可用的搜索站点
3. 搜索后仅显示标题和编号，用户可以选择想要获取详情的结果
4. 选择编号后，机器人会从缓存中获取并显示对应的网盘链接
5. 搜索结果会缓存5分钟，提高响应速度并减少重复请求
6. 加剧功能通过向短剧网站提交评论实现，将用户提交的剧名添加到网站的待收录列表

## 注意事项

1. 插件依赖网络访问外部站点，请确保网络连接正常
2. 搜索功能依赖第三方网站，如遇异常请检查网站可用性或更新URL配置
3. 建议定期更新`short_urls`配置，以获取最新的镜像站点
4. 插件默认只在白名单群聊中生效，请根据需要配置`whitelist_groups`
5. 搜索结果缓存会在5分钟后自动过期，过期后需要重新搜索
6. 加剧功能提交后，通常需要等待1天左右才能搜索到相关资源

## 更新日志

### v1.2.0
- 新增加剧功能，支持提交未收录的剧名
- 优化评论提交逻辑，提高加剧成功率
- 改进错误处理和日志记录

### v1.1.0
- 支持多个搜索源，自动选择可用站点
- 自动解析短链获取最新可用站点
- 支持断线重连和站点自动切换
- 支持群聊白名单，只在指定群聊中生效
- 完全异步实现，不阻塞主线程
- 支持网盘链接提取
- 丰富的日志记录
- 二步操作逻辑，避免一次性输出大量链接
- 搜索结果缓存，提高响应速度

## 许可证

本插件仅供学习和个人使用，请勿用于商业用途。 
