# DuanjuSpider 短剧搜索插件

## 插件介绍

DuanjuSpider是一个微信机器人插件，用于在群聊中搜索短剧资源。通过简单的命令，可以快速查找各类短剧并获取网盘链接，为群友提供便捷的资源获取方式。

作者: BEelzebub  
版本: 1.0.0

## 功能特点

- 支持多个搜索源，自动选择可用站点
- 自动解析短链获取最新可用站点
- 支持断线重连和站点自动切换
- 支持群聊白名单，只在指定群聊中生效
- 完全异步实现，不阻塞主线程
- 支持网盘链接提取
- 丰富的日志记录

## 安装方法

1. 确保已安装所需的依赖：
```bash
pip install requests beautifulsoup4 aiohttp loguru tomli
```

2. 将`DuanjuSpider`文件夹复制到机器人的插件目录中

3. 重启机器人或加载插件

## 配置说明

插件配置文件为`config.toml`，主要配置项如下：

```toml
[DuanjuSpider]
enable = true                               # 是否启用插件

# 短剧搜索命令
command = "短剧"                            # 触发插件的命令前缀

# 群聊白名单，只在这些群聊中生效
whitelist_groups = ["*"]

# 搜索基础URL列表，用于查询短剧资源
# 程序会依次尝试列表中的URL，直到找到可用的站点
base_urls = [
    "https://a80.35240.com/search.php",
    "https://b.21410.com/search.php"
]

# 短链接列表，用于解析获取最新的可用站点
# 程序会自动解析这些短链，并将解析结果添加到base_urls中
short_urls = [
    "A80.CC",
    "A20.CC",
    "E50.CC",
    "47C.CC"
]
```

程序会使用`search_urls.json`文件来存储已解析的URL和运行时更新的URL列表。该文件会在首次运行时根据config.toml中的配置自动创建，格式如下：

```json
{
    "base_urls": [
        "https://a80.35240.com/search.php",
        "https://b.21410.com/search.php"
    ],
    "short_urls": [
        "A80.CC",
        "A20.CC",
        "E50.CC",
        "47C.CC"
    ]
}
```

您可以根据需要修改这些配置文件。如果希望立即添加新的搜索站点，可以直接在`config.toml`中的`base_urls`添加；如果想添加新的短链来源，可以在`short_urls`中添加。

## 使用方法

在已配置的群聊中，使用以下命令格式：

```
短剧 [剧名]
```

例如：
```
短剧 纵横商海
```

机器人会返回搜索结果，包含剧名和网盘链接。

## 工作原理

1. 插件启动时会解析配置的短链接，获取最新的搜索站点URL
2. 接收到符合命令格式的消息后，会依次尝试可用的搜索站点
3. 从搜索结果中提取详情页链接，并访问详情页获取网盘链接
4. 将提取到的结果格式化后发送到群聊

## 注意事项

1. 插件依赖网络访问外部站点，请确保网络连接正常
2. 搜索功能依赖第三方网站，如遇异常请检查网站可用性或更新URL配置
3. 建议定期更新`short_urls`配置，以获取最新的镜像站点
4. 插件默认只在白名单群聊中生效，请根据需要配置`whitelist_groups`

## 许可证

本插件仅供个人学习使用，请勿用于商业用途。 
